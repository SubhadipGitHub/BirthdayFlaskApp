{% extends "base.html" %}

{% block title %}Travel Recommendations{% endblock %}

{% block content %}
    <div class="container">
        <h3>Travel Recommendations</h3>
        <div id="map" style="height: 500px;"></div>
        
        <h4>Mark Places Youâ€™ve Traveled</h4>
        <button class="waves-effect waves-light btn-large" id="add-marker-btn">Add Marker</button>
        <br>
        <div id="places-list">
            <!-- Dynamic list of places will be added here -->
        </div>
    </div>

    <!-- Modal -->
    <div id="addMarkerModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Add Marker</h2>
            <form id="add-marker-form">
                <label for="marker-name">Name:</label>
                <input type="text" id="marker-name" name="name" required><br><br>
                <label for="marker-lat">Latitude:</label>
                <input type="number" id="marker-lat" name="lat" step="any" required><br><br>
                <label for="marker-lng">Longitude:</label>
                <input type="number" id="marker-lng" name="lng" step="any" required><br><br>
                <button type="submit">Add Marker</button>
            </form>
        </div>
    </div>

    <!-- Include Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

    <script>
        // Ensure the DOM is fully loaded before running the script
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize the map
            var map = L.map('map').setView([20, 0], 2); // Center of the world, zoom level 2

            // Add a tile layer to the map
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);

            var places = [
                // Global Popular Destinations
                { name: 'Paris', lat: 48.8566, lng: 2.3522 },
                { name: 'New York', lat: 40.7128, lng: -74.0060 },
                { name: 'Tokyo', lat: 35.6895, lng: 139.6917 },
                { name: 'London', lat: 51.5074, lng: -0.1278 },
                { name: 'Sydney', lat: -33.8688, lng: 151.2093 },
                { name: 'Dubai', lat: 25.2048, lng: 55.2708 },
                { name: 'Rome', lat: 41.9028, lng: 12.4964 },
                { name: 'Bangkok', lat: 13.7563, lng: 100.5018 },
                { name: 'Los Angeles', lat: 34.0522, lng: -118.2437 },
                { name: 'Singapore', lat: 1.3521, lng: 103.8198 },
                { name: 'Barcelona', lat: 41.3851, lng: 2.1734 },
                { name: 'Istanbul', lat: 41.0082, lng: 28.9784 },
                { name: 'Hong Kong', lat: 22.3193, lng: 114.1694 },
                { name: 'Amsterdam', lat: 52.3676, lng: 4.9041 },
                { name: 'San Francisco', lat: 37.7749, lng: -122.4194 },
                { name: 'Berlin', lat: 52.5200, lng: 13.4050 },
                { name: 'Rio de Janeiro', lat: -22.9068, lng: -43.1729 },
                { name: 'Cape Town', lat: -33.9249, lng: 18.4241 },
                { name: 'Moscow', lat: 55.7558, lng: 37.6173 },
                { name: 'Cairo', lat: 30.0444, lng: 31.2357 },
                // ... add more global destinations

                // Indian Popular Destinations
                { name: 'Taj Mahal', lat: 27.1751, lng: 78.0421 },
                { name: 'Jaipur', lat: 26.9124, lng: 75.7873 },
                { name: 'Goa', lat: 15.2993, lng: 74.1240 },
                { name: 'Mumbai', lat: 19.0760, lng: 72.8777 },
                { name: 'Delhi', lat: 28.6139, lng: 77.2090 },
                { name: 'Bangalore', lat: 12.9716, lng: 77.5946 },
                { name: 'Chennai', lat: 13.0827, lng: 80.2707 },
                { name: 'Kolkata', lat: 22.5726, lng: 88.3639 },
                { name: 'Kerala', lat: 10.8505, lng: 76.2711 },
                { name: 'Agra', lat: 27.1767, lng: 78.0081 },
                { name: 'Hyderabad', lat: 17.3850, lng: 78.4867 },
                { name: 'Pune', lat: 18.5204, lng: 73.8567 },
                { name: 'Ahmedabad', lat: 23.0225, lng: 72.5714 },
                { name: 'Jaipur', lat: 26.9124, lng: 75.7873 },
                { name: 'Manali', lat: 32.2432, lng: 77.1892 },
                { name: 'Shimla', lat: 31.1048, lng: 77.1734 },
                { name: 'Udaipur', lat: 24.5854, lng: 73.7125 },
                { name: 'Varanasi', lat: 25.3176, lng: 82.9739 },
                { name: 'Jaisalmer', lat: 26.9157, lng: 70.9083 },
                { name: 'Rishikesh', lat: 30.0869, lng: 78.2676 },
                // ... add more Indian destinations
            ];

            // Function to add markers and check for traveled places
            function addMarkers() {
                places.forEach(function(place) {
                    var marker = L.marker([place.lat, place.lng]).addTo(map);
                    marker.bindPopup('<b>' + place.name + '</b>');
                    marker.on('click', function() {
                        var listItem = document.createElement('div');
                        listItem.innerHTML = '<input type="checkbox" checked> ' + place.name;
                        document.getElementById('places-list').appendChild(listItem);
                    });
                });
            }

            addMarkers();

            // Modal functionality
            var modal = document.getElementById("addMarkerModal");
            var btn = document.getElementById("add-marker-btn");
            var span = document.getElementsByClassName("close")[0];

            btn.onclick = function() {
                modal.style.display = "block";
            }

            span.onclick = function() {
                modal.style.display = "none";
            }

            window.onclick = function(event) {
                if (event.target == modal) {
                    modal.style.display = "none";
                }
            }

            document.getElementById("add-marker-form").onsubmit = function(event) {
                event.preventDefault();
                var name = document.getElementById("marker-name").value;
                var lat = parseFloat(document.getElementById("marker-lat").value);
                var lng = parseFloat(document.getElementById("marker-lng").value);
                
                var marker = L.marker([lat, lng]).addTo(map);
                marker.bindPopup('<b>' + name + '</b>');

                var listItem = document.createElement('div');
                listItem.innerHTML = '<input type="checkbox" checked> ' + name;
                document.getElementById('places-list').appendChild(listItem);

                modal.style.display = "none";
            };
        });
    </script>

    <!-- Additional CSS for Map -->
    <style>
        .waves-effect {
            z-index: 0;
        }
        
        #map {
            width: 100%;
        }

        #places-list {
            margin-top: 20px;
        }

        #places-list div {
            margin-bottom: 10px;
        }

        /* Modal styles */
        .modal {
            display: none; 
            position: relative; 
            left: 0;
            top: 0;
            width: 100%; 
            height: 100%; 
            overflow: auto; 
            background-color: rgb(0,0,0); 
            background-color: rgba(0,0,0,0.4); 
            padding-top: 60px;
        }

        .modal-content {
            background-color: #fefefe;
            margin: 5% auto; 
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
    </style>
{% endblock %}
