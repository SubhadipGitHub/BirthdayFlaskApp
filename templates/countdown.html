{% extends "base.html" %}

{% block content %}
<style>
    /*override material style*/
    h1 {
      font-size: 2.2rem;
    }
    .responsive {
        display: block;
        margin-bottom: 100px;
    }

    .gallery {
        border: 1px solid #ccc;
        border-radius: 10px;
        overflow: hidden;
        padding: 10px;
        background-color: #f9f9f9;
    }

    .gallery img {
        border-radius: 50%;
        width: 100%;
        height: auto;
    }

    .desc {
        text-align: center;
        padding: 10px;
    }

    .desc h4 {
        margin: 10px 0;
        font-size: 1.2em;
        font-weight: bold;
    }

    .desc span {
        display: block;
        font-size: 1em;
    }

    .countdown-wrapper {
        background-color: azure;
        border-radius: 10px;
        border: 1px solid #ccc;
    }

    .birthday-wrapper {
        padding: 10px;
        background-color: azure;
        border: 1px solid;
    }
</style>
<div class="container">
    <div class="countdown-wrapper" id="countdown-wrapper">      
        <h1>Countdown to Her Special Day</h1>
        <img src="https://media.giphy.com/media/KOfp5sCYol4S4/200.gif" alt="Loading Gif">
        <div id="countdown"></div>
        <p>We can't wait to celebrate this special day with her!</p>
    </div>
    <div class="birthday-wrapper" id="birthday-wrapper" style="display:none;">
        <div class="birthday-message" id="birthday-message"></div>
        <br>        
        <!-- Material Design Button -->
        <a class="waves-effect waves-light btn-large" id="openLetterButton">Open Your Letter</a>
        
        <!-- Modal Structure -->
        <div id="letterModal" class="modal">
            <div class="modal-content">
                <h4>A Sweet Letter for You</h4>
                <img src="https://i.pinimg.com/originals/31/15/98/31159803ceb30f8bc31edadccfeffe5f.gif" alt="Sweet GIF">
                <hr>
                <p>
                    Dear {{ name }},
                    <br><br>
                    On the ocassion of your birthday today, when you will be turning {{age}}, I find myself reflecting on the wonderful journey that has brought us together. It all began through a matrimony website, a place I never expected to find such a vibrant and joyful soul.
                    <br><br>
                    From the moment we met, your confidence and ambition have been evident, and they continue to inspire me every day. You have this incredible ability to balance your drive for success with a zest for life that is truly remarkable. Your love for the outdoors and all things adventurous is contagious, and I cherish every moment we’ve spent exploring and enjoying nature together.
                    <br><br>
                    You challenge me in ways that help me grow, and your sweet and caring nature provides the perfect balance to our dynamic. I feel incredibly fortunate to have had the chance to know you and to share in your laughter and love.
                    <br><br>
                    As you celebrate another year of life, I wish you nothing but the best. May this year bring you even more opportunities to live fully, laugh heartily, and love deeply. I am excited to see what the future holds for you, and I am grateful for the memories we’ve created and those yet to come.
                    <br><br>
                    Happy Birthday, {{name}}. Here’s to a wonderful year ahead!
                    <br><br>
                    Best Regards,<br>
                    {{sender_name}}
                </p>
            </div>
            <div class="modal-footer">
                <a href="#!" class="modal-close waves-effect waves-green btn-flat">Close</a>
            </div>
        </div>
    </div>
    <br>    
    <hr>
    <iframe style="border-radius:12px" src="https://open.spotify.com/embed/playlist/37i9dQZF1DWXVJK4aT7pmk?utm_source=generator&theme=0" width="100%" height="152" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
    {% if astronomy %}
        <h4>Astronomical Prediction</h4>
        <p>Name : {{name}}</p>
        <p>Birthday : {{birthdate}}</p>
        <p>Star Sign : {{astronomy['name']}}</p>
        <br>
        {% for trait in astronomy['traits'] %} 
            <div class="responsive">
                <div class="gallery">
                    <a target="_blank" href="https://www.instagram.com/p/Cd3duw7vYpl1MGFrZH6I71bOMiqkhVjySLcR3I0/?img_index=1">
                        <img src="{{trait['image_url']}}" alt="astronomical trait image">
                    </a>
                    <div class="desc">
                        <h4>{{trait['trait']}}</h4>
                        <span>{{trait['description']}}</span>
                    </div>
                </div>
            </div>
        {% endfor %}
    {% else %}
        <p>No Astrological data found!</p>
    {% endif %}
    <br>
    <br>
    <br>
</div>
    <!-- Include Materialize JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

    <!-- JavaScript for Modal -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var elems = document.querySelectorAll('.modal');
            var instances = M.Modal.init(elems);

            // Initialize the modal
            var modalInstance = M.Modal.getInstance(document.getElementById('letterModal'));

            // Open modal when button is clicked
            document.getElementById('openLetterButton').addEventListener('click', function() {
                modalInstance.open();
            });
        });

        // Set the date we're counting down to
        var countDownDate = new Date("{{bdate_formatted}}").getTime();

        var message = "{{ message }}";
        var gif_url = "{{ gif_url }}";

        // Update the count down every 1 second
        var x = setInterval(function() {

        // Get today's date and time
        var now = new Date().getTime();

        // Find the distance between now and the count down date
        var distance = countDownDate - now;

        // Time calculations for days, hours, minutes and seconds
        var days = Math.floor(distance / (1000 * 60 * 60 * 24));
        var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        var seconds = Math.floor((distance % (1000 * 60)) / 1000);

        // Display the result in the element with id="countdown"
        document.getElementById("countdown").innerHTML = `
            <div>${days}<span> Days</span></div>
            <div>${hours}<span> Hours</span></div>
            <div>${minutes}<span> Minutes</span></div>
            <div>${seconds}<span> Seconds</span></div>
        `;

        // If the count down is finished, replace the countdown with the birthday message
        if (distance < 0) {
            clearInterval(x);
            var countdownWrapper = document.getElementById('countdown-wrapper');
            var birthdayWrapper = document.getElementById('birthday-wrapper');
            var birthdayMessage = document.getElementById('birthday-message');

            birthdayMessage.innerHTML = `
            <p>${message}</p>
            <img src="${gif_url}" alt="Birthday Gif">
            `;

            countdownWrapper.style.opacity = '0';
            setTimeout(function() {
            countdownWrapper.style.display = 'none';
            birthdayWrapper.style.display = 'block';
            setTimeout(function() {
                birthdayWrapper.style.opacity = '1';
            }, 50);
            }, 1500); // Match the transition duration
        }
        }, 1000);
    </script>

    <!-- Additional CSS for Modal -->
    <style>
        .modal {
            max-height: 80%; /* Adjust for different screen sizes */
            width: 90%;
        }

        .modal-content {
            font-size: 1.1em;
            text-align: left;
        }

        .modal-footer {
            text-align: center;
        }

        .modal-close {
            background-color: #333;
            color: white;
            border-radius: 5px;
        }

        .modal-close:hover {
            background-color: #555;
        }
    </style>
{% endblock %}
